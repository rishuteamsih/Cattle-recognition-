<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<title>Cattle Recognizer — Fixed Marquee</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&amp;display=swap" rel="stylesheet"/>
<style>
    :root{
      --bg1:#0f172a;
      --accent:#ffdd57;
      --glass: rgba(255,255,255,0.05);
      --move:2000px;
      --duration:16s;
    }
    *{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg1),#071025);color:#e6eef8}
    a{color:inherit;text-decoration:none}

    .container{max-width:1100px;margin:40px auto;padding:20px}
    header{display:flex;align-items:center;justify-content:space-between;gap:16px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:56px;height:56px;background:linear-gradient(135deg,#0ea5a4,#06b6d4);display:flex;align-items:center;justify-content:center;border-radius:12px;box-shadow:0 6px 20px rgba(3,7,18,0.6)}
    .logo svg{width:36px;height:36px}
    .title{font-weight:700;font-size:18px}
    .subtitle{font-size:12px;opacity:0.8}

    .page{min-height:70vh;padding:28px;border-radius:16px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));box-shadow:0 8px 30px rgba(2,6,23,0.6);backdrop-filter: blur(6px)}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:28px;align-items:center}

    .hero h1{font-size:36px;margin:0 0 8px}
    .lead{color:#bcd6ea;margin-bottom:16px}
    .cta{display:flex;gap:12px;margin-top:16px}
    .btn{background:var(--accent);color:#002a2a;padding:12px 18px;border-radius:10px;font-weight:700;border:none;cursor:pointer;box-shadow:0 8px 30px rgba(255,221,87,0.15);transition:transform 0.2s}
    .btn:hover{transform:scale(1.05)}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#dcecff}

    .scene{position:relative;overflow:hidden;border-radius:14px;background:linear-gradient(180deg,#07263a 0%, #04404f 100%);height:420px;display:flex;align-items:center;justify-content:center;flex-direction:column}
    .scene h2{margin-bottom:20px;color:#fff;font-size:22px}

    /* FIXED MARQUEE - FIXES ADDED */
    .cattle-strip-wrapper{width:100%;overflow:hidden;padding:8px 12px}
    .track{
      display:flex;
      gap:36px;
      align-items:center;
      will-change:transform;
      transform:translate3d(0,0,0);
      animation:marquee var(--duration) linear infinite;
      /* prevent wrapping and ensure a single long row */
      width: max-content;
    }
    .set{
      display:flex;
      gap:36px;
      align-items:center;
      flex-shrink:0; /* important: prevent shrinking which caused overlap */
    }
    .cattle-card{flex:0 0 auto;text-align:center}
    .cattle-card img{
      width:280px;
      height:200px;
      object-fit:cover;
      border-radius:12px;
      box-shadow:0 4px 14px rgba(0,0,0,0.4);
      transition:transform 0.3s ease;
      display:block;
      max-width:100%;
    }
    .cattle-card img:hover{transform:scale(1.08)}
    .cattle-card span{display:block;margin-top:6px;font-size:14px;color:#e6eef8;opacity:0.85}

    @keyframes marquee{
      from{transform:translate3d(0,0,0)}
      to{transform:translate3d(calc(-1 * var(--move)),0,0)}
    }
    .track:hover{animation-play-state:paused}

    .toolbar{display:flex;gap:10px;align-items:center;margin-bottom:14px}
    .controls{display:flex;gap:10px;align-items:center}
    .panel{background:var(--glass);padding:12px;border-radius:12px}
    video, canvas, img{max-width:100%;border-radius:12px}

    footer{margin-top:26px;color:#9fb6cc;font-size:13px;opacity:0.9}
    .chip{padding:6px 8px;background:rgba(255,255,255,0.03);border-radius:999px;font-weight:600;cursor:pointer;border:none}
    .muted{opacity:0.75;font-size:13px}

    /* POPUPS */
    .popup{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);align-items:center;justify-content:center;z-index:999}
    .popup-content{background:#0b1220;padding:20px;border-radius:12px;max-width:500px;width:90%;color:#fff;position:relative}
    .popup-content h3{margin-top:0}
    .close{position:absolute;top:10px;right:14px;cursor:pointer;font-size:20px}
    .feedback-form input,.feedback-form textarea{width:100%;margin-bottom:10px;padding:8px;border-radius:8px;border:none}

    /* responsive tweak to avoid overlap on narrow screens */
    @media (max-width:720px){
      .grid{grid-template-columns:1fr;gap:18px}
      .cattle-card img{width:200px;height:140px}
    }
    @media (max-width:420px){
      .cattle-card img{width:160px;height:110px}
    }
  </style>
</head>
<body>
<div class="container">
<header>
<div class="brand">
<div class="logo">
<svg fill="none" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M4 7s1-2 4-2c3 0 4 2 4 2" stroke="#042A2A" stroke-width="1.2"></path>
<path d="M20 7s-1-2-4-2c-3 0-4 2-4 2" stroke="#042A2A" stroke-width="1.2"></path>
<ellipse cx="12" cy="14" fill="#fff" opacity="0.18" rx="7" ry="5"></ellipse>
</svg>
</div>
<div>
<div class="title">Cattle Recognizer</div>
<div class="subtitle">On-device demo · No server needed · Privacy-first</div>
</div>
</div>
<nav>
<a class="chip" href="#intro">Intro</a>
<a class="chip" href="javascript:void(0)" onclick="openPopup('howToPopup')">How to Use</a>
</nav>
</header>
<main style="margin-top:20px">
<!-- INTRO PAGE -->
<section class="page" id="intro">
<div class="grid">
<div class="hero">
<h1>Expert cattle recognition — smooth infinite loop</h1>
<p class="lead">Welcome! Start exploring cattle recognition in just one click. The app runs directly in your browser using AI.</p>
<div class="cta"><button class="btn" onclick="showApp()">▶ Start Recognition</button></div>
</div>
<div class="scene">
<h2>Recognize Cattle Breed</h2>
<div class="cattle-strip-wrapper">
<div aria-hidden="false" class="track" id="track">
<div class="set" id="set1">
<div class="cattle-card"><img alt="Cow 1" src="https://plus.unsplash.com/premium_photo-1677850457283-3523ea2954bb?w=600&amp;auto=format&amp;fit=crop&amp;q=60&amp;ixlib=rb-4.1.0&amp;ixid=M3wxMjA3fDB8MHxwaG90by1yZWxhdGVkfDF8fHxlbnwwfHx8fHw%3D"/><span>Cow 1</span></div>
<div class="cattle-card"><img alt="Cow 2" src="https://d1jyxxz9imt9yb.cloudfront.net/medialib/4813/image/s1300x1300/LC202306_AmboseliWildlife_055_429144-reduced.jpg"/><span>Cow 2</span></div>
<div class="cattle-card"><img alt="Cow 3" src="https://media.istockphoto.com/id/2157881968/photo/beautiful-cattle-in-australia-eating-grass-grazing-on-pasture.webp?a=1&amp;b=1&amp;s=612x612&amp;w=0&amp;k=20&amp;c=FmFoarL5KKaY7xQ9nrmmnsCsDe8ehMAGCHrgnKqSzfc="/><span>Cow 3</span></div>
<div class="cattle-card"><img alt="Cow 4" src="https://media.istockphoto.com/id/1303666715/photo/we-herd-you-were-looking-for-some-magnificent-cattle.webp?a=1&amp;b=1&amp;s=612x612&amp;w=0&amp;k=20&amp;c=pDRnVjNBYz6YbRtC7mFoULhUWaVgAkt8wkzVSPu6XHM="/><span>Cow 4</span></div>
<div class="cattle-card"><img alt="Cow 5" src="https://images.unsplash.com/photo-1568134234029-2cae365d550b?q=80&amp;w=1172&amp;auto=format&amp;fit=crop&amp;ixlib=rb-4.1.0&amp;ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D="/><span>Cow 5</span></div>
<div class="cattle-card"><img alt="Cow 6" src="https://cdn.britannica.com/53/157153-050-E5582B5A/Holstein-cow.jpg"/><span>Cow 6</span></div>
<div class="cattle-card"><img alt="Cow 7" src="https://images.unsplash.com/photo-1603696861627-db79cf52fecb?q=80&amp;w=1170&amp;auto=format&amp;fit=crop&amp;ixlib=rb-4.1.0&amp;ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"/><span>Cow 7</span></div>
<div class="cattle-card"><img alt="Cow 8" src="https://images.unsplash.com/photo-1622266955241-654a8bc6abbd?q=80&amp;w=1170&amp;auto=format&amp;fit=crop&amp;ixlib=rb-4.1.0&amp;ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"/><span>Cow 8</span></div>
</div>
<div aria-hidden="true" class="set" id="set2"></div>
</div>
</div>
</div>
</div>
</section>
<!-- RECOGNITION PAGE (hidden initially) -->
<section class="page" id="app" style="margin-top:26px; display:none;">
<h2>Recognition</h2>
<div class="toolbar">
<div class="controls">
<button class="btn ghost" onclick="init()">Start webcam</button>
<input accept="image/*" class="btn ghost" id="uploadImage" type="file"/>
</div>
<button class="btn" onclick="openPopup('demoPopup')">Demo Video</button>
<button class="btn" onclick="openPopup('feedbackPopup')">Feedback</button>
</div>
<div class="panel" style="text-align:center;padding:40px">
<h3>Teachable Machine Demo Space</h3>
<video autoplay="" height="300" id="webcam" playsinline="" width="400"></video>
<div id="label-container" style="margin-top:10px;"></div>
</div>
<footer>Built for demo — runs locally. Try different images and lighting for best results.</footer>
</section>
</main>
</div>
<!-- POPUPS -->
<div class="popup" id="howToPopup"><div class="popup-content"><span class="close" onclick="closePopup('howToPopup')">✖</span><h3>How to Use</h3><p>1. Click Start Recognition.<br/>2. Allow webcam access or upload an image.<br/>3. The AI will highlight cattle.<br/>4. Adjust confidence slider for accuracy.</p></div></div>
<div class="popup" id="demoPopup"><div class="popup-content"><span class="close" onclick="closePopup('demoPopup')">✖</span><h3>Demo Video</h3><iframe allowfullscreen="" id="demoVideo" src="" style="width:100%;height:260px;"></iframe></div></div>
<div class="popup" id="feedbackPopup"><div class="popup-content"><span class="close" onclick="closePopup('feedbackPopup')">✖</span><h3>Feedback Form</h3>
<form action="https://api.web3forms.com/submit" class="feedback-form" method="POST">
<input name="access_key" type="hidden" value="59ec9f20-a69c-4174-a0e3-c9f27f8cdd3c"/><input placeholder="Your Name" required="" type="text"/><input placeholder="Mobile No." required="" type="tel"/><input placeholder="Email" required="" type="email"/><textarea placeholder="Suggestions / Complaints" required="" rows="4"></textarea><button class="btn" type="submit">Submit Feedback</button></form></div></div>
<script>
    function showApp(){
      document.getElementById('app').style.display='block';
      document.getElementById('app').scrollIntoView({behavior:'smooth'});
    }
    function openPopup(id){ document.getElementById(id).style.display='flex' }
    function closePopup(id){
      document.getElementById(id).style.display='none';
      if(id==='demoPopup'){ document.getElementById('demoVideo').src='' }
    }

    // === FIXED MARQUEE SCRIPT ===
    document.addEventListener('DOMContentLoaded',()=>{

      const set1 = document.getElementById('set1');
      const set2 = document.getElementById('set2');
      const track = document.getElementById('track');

      if(!set1 || !set2 || !track) return;

      // duplicate content for infinite-looking scroll
      set2.innerHTML = set1.innerHTML;

      // wait for all images to load so we can measure widths correctly
      const imgs = Array.from(track.querySelectorAll('img'));
      Promise.all(imgs.map(img => img.complete ? Promise.resolve() : new Promise(res => { img.onload = res; img.onerror = res })))
      .then(() => {
        // measure width of the first set (includes gaps)
        const setWidth = Math.ceil(set1.getBoundingClientRect().width);

        // set CSS variables for animation
        const pxPerSec = 160; // speed base
        const durationSec = Math.max(4, setWidth / pxPerSec);

        // set the movement to the width of one set (so second set follows seamlessly)
        document.documentElement.style.setProperty('--move', setWidth + 'px');
        document.documentElement.style.setProperty('--duration', durationSec + 's');

        // ensure track is wide enough for two sets side-by-side (prevents wrapping/overlap)
        track.style.width = (setWidth * 2) + 'px';

        // lock each set so they don't shrink (helps on some browsers)
        set1.style.flex = '0 0 ' + setWidth + 'px';
        set2.style.flex = '0 0 ' + setWidth + 'px';

        // accessibility: mark second set as hidden for screen readers
        set2.setAttribute('aria-hidden','true');
      });

      // pause on hover (already in CSS), but also pause when app is not visible to save CPU
      document.addEventListener('visibilitychange', () => {
        if (document.hidden) track.style.animationPlayState = 'paused';
        else track.style.animationPlayState = 'running';
      });
    });
  </script>

<!-- Teachable Machine Scripts -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image"></script>
<script>
  const MODEL_LOCAL = "./model/";
  const MODEL_REMOTE = "https://teachablemachine.withgoogle.com/models/x_FYO_rKZ/";

  let model, webcam, labelContainer, maxPredictions;

  async function init() {
    const modelURL = URL + "model.json";
    const metadataURL = URL + "metadata.json";

    model = await tmImage.load(modelURL, metadataURL);
    maxPredictions = model.getTotalClasses();

    const flip = true;
    webcam = new tmImage.Webcam(400, 300, flip);
    await webcam.setup();
    await webcam.play();
    window.requestAnimationFrame(loop);

    document.getElementById("webcam").replaceWith(webcam.canvas);
    labelContainer = document.getElementById("label-container");
    labelContainer.innerHTML = "";
    for (let i = 0; i < maxPredictions; i++) {
      labelContainer.appendChild(document.createElement("div"));
    }
  }

  async function loop() {
    webcam.update();
    await predict();
    window.requestAnimationFrame(loop);
  }

  async function predict() {
    const prediction = await model.predict(webcam.canvas);
    for (let i = 0; i < maxPredictions; i++) {
      const classPrediction =
        prediction[i].className + ": " + prediction[i].probability.toFixed(2);
      labelContainer.childNodes[i].innerHTML = classPrediction;
    }
  }
</script>

<script>
/* Upload handler: loads model if needed, stops webcam, shows uploaded image and predictions.
   Note: we use window.URL.createObjectURL so it doesn't conflict with the `URL` variable
   that holds the model path in the page.
*/
(function(){
  const input = document.getElementById("uploadImage");
  if (!input) return;

  input.addEventListener("change", async (event) => {
    try {
      const file = event.target.files && event.target.files[0];
      if (!file) return;

      // stop webcam if running
      try {
        if (typeof webcam !== "undefined" && webcam && webcam.stop) {
          webcam.stop();
        }
      } catch (e) {
        console.warn("Error stopping webcam:", e);
      }

      // ensure the model is loaded
      if (typeof model === "undefined" || model === null) {
        const modelURL = URL + "model.json";
        const metadataURL = URL + "metadata.json";
        try {
          model = await tmImage.load(modelURL, metadataURL);
          maxPredictions = model.getTotalClasses();
        } catch (err) {
          console.error("Failed to load model:", err);
          alert("Failed to load the model. Check the console for details.");
          return;
        }

        // prepare label container
        labelContainer = document.getElementById("label-container");
        if (labelContainer) {
          labelContainer.innerHTML = "";
          for (let i = 0; i < maxPredictions; i++) {
            labelContainer.appendChild(document.createElement("div"));
          }
        }
      } else {
        // ensure labelContainer exists
        labelContainer = document.getElementById("label-container");
        if (labelContainer) {
          labelContainer.innerHTML = "";
        }
      }

      // create image element for preview
      const img = document.createElement("img");
      img.style.maxWidth = "100%";
      img.style.maxHeight = "360px";
      img.style.borderRadius = "12px";
      img.alt = "Uploaded image preview";

      // Use the global window.URL to avoid collision with the model URL variable named `URL`
      img.src = window.URL.createObjectURL(file);

      img.onload = async () => {
        try {
          const prediction = await model.predict(img);
          // Show predictions (sorted by probability desc)
          prediction.sort((a,b) => b.probability - a.probability);
          labelContainer.innerHTML = "";
          prediction.forEach(p => {
            const div = document.createElement("div");
            // show percent for readability
            div.textContent = `${p.className}: ${(p.probability*100).toFixed(1)}%`;
            labelContainer.appendChild(div);
          });
        } catch (err) {
          console.error("Prediction failed:", err);
          alert("Prediction failed. See console for details.");
        }
      };

      img.onerror = () => {
        console.error("Uploaded image failed to load.");
        alert("Could not load the uploaded image.");
      };

      // display the uploaded image in the webcam container (replace canvas/video)
      const container = document.getElementById("webcam-container");
      if (container) {
        container.innerHTML = "";
        container.appendChild(img);
      } else {
        console.warn("No #webcam-container element found to show the uploaded image.");
      }
    } catch (e) {
      console.error("Upload handler error:", e);
      alert("An unexpected error occurred. See console for details.");
    }
  });
})();
</script>

</body>
</html>

<!-- Fallback model loader appended by assistant -->
<script>
  // ... omitted for brevity (should not happen) ...
</script>
